# OSI七层体系

**应用层**：管理特定协议。用户在应用界面输入发送的内容、地址之后，应用层会根据邮箱的相关协议，对数据进行封装。**常见的协议HTTP FTP TFTP SMTP SNMP DNS TELNET HTTPS POP3 DHCP**

**表示层**：数据的表示、安全、压缩。

**会话层**：建立、管理、终止会话。

**传输层**：传输层是端到端通信，会判断数据是否送达。**常见的协议TCP UDP**

**网络层**：将数据传到目标网络，包括网络寻址等。**常见协议ICMP IGMP IP（IPV4 IPV6）**

**数据链路层**：建立逻辑连接、进行硬件地址寻址、差错校验等功能。将比特组合成字节进而组合成帧，用MAC地址访问介质，错误发现但不能纠正。常见的协议**ARP，CSMA/CD**

**物理层**：比特流转成光电信号

![](https://picgo-markdown.oss-cn-beijing.aliyuncs.com/img/OSI.png)

# TCP/IP 五层体系



![](https://picgo-markdown.oss-cn-beijing.aliyuncs.com/img/TCPIP.png)

# IP地址和MAC地址的区别

从层次的角度看，MAC是物理地址地址，在数据链路层和物理层所使用的地址。而IP地址是逻辑地址，在网络层以及以上所使用。由于全世界有各种各样的网络使用的硬件地址标准也不一样。要使得这些异构的网络进行通信就要进行非常复杂的硬件地址转化工作，用户主机无法完成这样庞大的工作。而IP地址解决了这个麻烦。连接到因特网上的主机只需要拥有一个统一IP地址，他们之间的通信就像连接在同一个网络上那样方便。当需要IP地址转化成为物理地址，调用ARP的复杂过程都是由计算机自动完成的。



# IP协议

IP地址共32位，4字节。

IP地址分为两部分：网络标识和主机标识。

A类IP地址：第一段为网络标识，剩下三段为主机标识。网络地址最高位必须为零。网络标识长度为7位，主机标识长度为24位。A类网络的主机数最多可以达到1600多台。

B类IP地址：第一、二段位网络标识，第三、四段为主机标识。网络地址最高位必须为10。网络标识长度为14位，主机标识长度位16位。每个网络最多能容纳6万多台主机。

C类IP地址：前三段位网络标识，剩下一段为主机标识。网络地址最高位必须为110。网络标识长度为21位，主机标识长度为8位。每个网络最多容纳254台主机。

子网掩码也是32位的一个IP地址，它的用途标识一个网络，识别本网络内的计算机。两台不同主机的IP地址同时与子网掩码进行AND运算，如果得出结果相同，则说明这两台计算机处于同一个子网内，可以进行直接通信。 域名的构成：主机名＋机构名＋网络名＋最高层域名。


## TCP特点

- 面向连接：面向连接，是指发送数据之前必须在两端建立连接。建立连接的方法是“三次握手”，这样能建立可靠的连接。建立连接，是为数据的可靠传输打下了基础。
- 仅支持单播传输：每条TCP传输连接只能有两个端点，只能进行点对点的数据传输，不支持多播和广播传输方式。

- 面向字节流：TCP不像UDP一样那样一个个报文独立地传输，而是在不保留报文边界的情况下以字节流方式进行传输。

- 可靠传输：对于可靠传输，判断丢包，误码靠的是TCP的段编号以及确认号。TCP为了保证报文传输的可靠，就给每个包一个序号，同时序号也保证了传送到接收端实体的包的按序接收。然后接收端实体对已成功收到的字节发回一个相应的确认(ACK)；如果发送端实体在合理的往返时延(RTT)内未收到确认，那么对应的数据（假设丢失了）将会被重传。
- 提供拥塞控制：当网络出现拥塞的时候，TCP能够减小向网络注入数据的速率和数量，缓解拥塞

- TCP提供全双工通信



## TCP三次握手

![](https://picgo-markdown.oss-cn-beijing.aliyuncs.com/img/三次握手.png)



所谓三次握手，是指建立一个TCP连接时，需要客户端和服务器总共发送3个包。三次握手的目的是连接服务器指定端口，建立TCP连接,并同步连接双方的序列号和确认号并交换 TCP 窗口大小信息.在socket编程中，客户端执行connect()时。将触发三次握手。

　　(1) 第一次握手：建立连接时，客户端A发送SYN包(SYN=j)到服务器B，并进入SYN_SEND状态，等待服务器B确认。
 　　(2) 第二次握手：服务器B收到SYN包，必须确认客户A的SYN(ACK=j+1)，同时自己也发送一个SYN包(SYN=k)，即SYN+ACK包，此时服务器B进入SYN_RECV状态。

　　 (3) 第三次握手：客户端A收到服务器B的SYN＋ACK包，向服务器B发送确认包ACK(ACK=k+1)，此包发送完毕，客户端A和服务器B进入ESTABLISHED状态，完成三次握手。完成三次握手，客户端与服务器开始传送数据。




## UDP特点

- 面向无连接： UDP 是不需要和 TCP一样在发送数据前进行三次握手建立连接的，想发数据就可以开始发送了。并且也只是数据报文的搬运工，不会对数据报文进行任何拆分和拼接操作。
- 有单播，多播，广播的功能：UDP 不止支持一对一的传输方式，同样支持一对多，多对多，多对一的方式，也就是说 UDP 提供了单播，多播，广播的功能。
- UDP是面向报文：发送方的UDP对应用程序交下来的报文，在添加首部后就向下交付IP层。UDP对应用层交下来的报文，既不合并，也不拆分，而是保留这些报文的边界。因此，应用程序必须选择合适大小的报文
- 不可靠性：TCP在数据传输中可能产生差错，只是尽最大可能交付。



区别

![](https://picgo-markdown.oss-cn-beijing.aliyuncs.com/img/TCP和UDP区别.png)







# 在浏览器中输入url地址到显示主页的过程

1. DNS解析：首先我们要访问 DNS 服务器获得网站对应的 IP 地址，这时我们需要把 DNS 报文封装到一个 UDP 报文中，进而封装到网络层的数据包中，填上源 IP，目的 DNS 服务器 IP 地址。接着封装链路层，填上网卡 MAC 地址和网关路由器 MAC 地址。接下来这个 DNS 请求报文就会经网关路由器发送给 DNS 服务器。接着 DNS 服务器会返回该域名的 IP 地址。

2. TCP连接：拿到了该网站的 IP 地址后就可以与该网站的服务器建立 TCP 连接了。建立 TCP 连接需要经过三次握手，过程如下：

   本机的 TCP 首先生成一个不带任何数据，SYN 标志位为 1，序号字段假设为client_num 的 TCP 报文，经过下层一系列网络栈后发送给目的 ip 服务器。

   该服务器接受到 TCP 请求报文后，会回应一个同意连接的 TCP 报文，这个报文的 SYN 标志位也会被置 1，序号字段假设为 server_num，ACK 响应字段为 client_num + 1。

   接受到同意连接的报文后，我方主机会进行响应，这次的 TCP 报文 SYN 位会被置0，序号字段为 client_num + 1，ACK 响应字段为 server + 1。并且这次的响应报文是可以携带数据的。

3. 发送HTTP请求：在三次握手建立连接后，本机就可以向服务器发送 HTTP 请求了，

4. 服务器处理请求并返回HTTP报文：服务器接受到了请求会做出响应的响应，把请求的数据发送给本机浏览器，最终浏览器把服务器响应的数据渲染显示出来，

5. 浏览器解析渲染页面

6. 连接结束



# HTTP 1.0和HTTP 1.1的主要区别是什么?

1. **长连接 : 在HTTP/1.0中，默认使用的是短连接，也就是说每次请求都要重新建立一次连接**。HTTP 是基于TCP/IP协议的,每一次建立或者断开连接都需要三次握手四次挥手的开销，如果每次请求都要这样的话，开销会比较大。**因此最好能维持一个长连接，可以用个长连接来发多个请求。**HTTP 1.1起，默认使用长连接 ,默认开启Connection： keep-alive。 HTTP/1.1的持续连接有非流水线方式和流水线方式 。流水线方式是客户在收到HTTP的响应报文之前就能接着发送新的请求报文。与之相对应的非流水线方式是客户在收到前一个响应后才能发送下一个请求。
2. **错误状态响应码 :在HTTP1.1中新增了24个错误状态响应码**，如409（Conflict）表示请求的资源与资源的当前状态发生冲突；410（Gone）表示服务器上的某个资源被永久性的删除。
3. **缓存处理** :在HTTP1.0中主要使用header里的If-Modified-Since,Expires来做为缓存判断的标准，**HTTP1.1则引入了更多的缓存控制策略例如Entity tag，If-Unmodified-Since, If-Match, If-None-Match等更多可供选择的缓存头来控制缓存策略**。
4. **带宽优化及网络连接的使用** :HTTP1.0中，存在一些浪费带宽的现象，**例如客户端只是需要某个对象的一部分，而服务器却将整个对象送过来了，并且不支持断点续传功能**，**HTTP1.1则在请求头引入了range头域，它允许只请求资源的某个部分**，即返回码是206（Partial Content），这样就方便了开发者自由的选择以便于充分利用带宽和连接。

# HTTP 和 HTTPS 的区别？

1. **端口 ：HTTP的URL由“http://”起始且默认使用端口80，而HTTPS的URL由“https://”起始且默认使用端口443。**
2. 安全性和资源消耗： **HTTP协议运行在TCP之上，所有传输的内容都是明文，客户端和服务器端都无法验证对方的身份**。**HTTPS是运行在SSL/TLS之上的HTTP协议，SSL/TLS 运行在TCP之上。所有传输的内容都经过加密，加密采用对称加密，**但对称加密的密钥用服务器方的证书进行了非对称加密。所以说，HTTP 安全性没有 HTTPS高，但是 HTTPS 比HTTP耗费更多服务器资源。

- - 对称加密：密钥只有一个，加密解密为同一个密码，且加解密速度快，典型的对称加密算法有DES、AES等；
  - 非对称加密：密钥成对出现（且根据公钥无法推知私钥，根据私钥也无法推知公钥），加密解密使用不同密钥（公钥加密需要私钥解密，私钥加密需要公钥解密），相对对称加密速度较慢，典型的非对称加密算法有RSA、DSA等。

# DHCP

作用：DHCP提供了一种即插即联网的机制。这种机制允许一台计算机加入新网络和获取IP地址不用手工参与。

过程：

1. 客户端从UDP端口68发送DHCP发现发现报文（源主机IP地址0.0.0.0，目的主机地址255.255.255.255）
2. 凡是收到DHCP发现报文的DHCP服务器都发送DHCP提供报文。可能由一个主机收到多个DHCP服务器的提供报文
3. 主机从多个DHCP服务器中选择一个，并向所有的DHCP服务器发送DHCP请求报文
4. 被选择的DHCP服务器发送确认报文DHCPACK。从这时候起主机就可以使用DHCP服务器分配的IP地址
5. 租用期过了一半，主机发送请求报文要求更新DHCPREQUEST
6. DHCP服务器若是同意发送确认报文DHCPACK，重新计时
7. DHCP服务器若是不同意发送否认报文DHCPNACK，此时主机必须立刻停止使用分配的IP
8. 主机可以随时提前终止服务器所提供的租用期，只需要向DHCP雾浮起发送释放报文DHCPRELEASE即可。

考点：

+  DHCP 报文，封装在一个 **UDP** 报文段中，里面包括**本机端口号 68 和目的端口号 67**，
+ 主机向DHCP中继代理发送报文是以**广播**形式，中继代理回复主机是以**单播**形式。